<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial 2: P22 Mouse Brain (RNA + ATAC) • mTopic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial 2: P22 Mouse Brain (RNA + ATAC)">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mTopic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial-1-data-preparation.html">Data Preparation</a>
    </li>
    <li>
      <a href="../articles/tutorial-2-P22-mouse-brain.html">P22 Mouse Brain (ATAC + RNA)</a>
    </li>
    <li>
      <a href="../articles/tutorial-3-human-tonsil.html">Human Tonsil (RNA + Protein Epitopes)</a>
    </li>
    <li>
      <a href="../articles/tutorial-4-human-pbmc.html">Human PBMC (ATAC + RNA + Protein Epitopes)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="https://github.com/TabakaLab/mTopic" class="external-link">Python Package</a>
</li>
<li>
  <a href="https://github.com/TabakaLab/mTopic/tree/main/dashboard" class="external-link">Interactive Dashboard</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/TabakaLab/mTopicR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial 2: P22 Mouse Brain (RNA + ATAC)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TabakaLab/mTopicR/blob/HEAD/vignettes/tutorial-2-P22-mouse-brain.Rmd" class="external-link"><code>vignettes/tutorial-2-P22-mouse-brain.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial-2-P22-mouse-brain.Rmd</code></div>

    </div>

    
    
<p>Welcome to this tutorial on using the <code>mTopic</code> package for
spatial multimodal topic modeling of the P22 mouse brain dataset with
ATAC and RNA modalities.</p>
<p>In this tutorial, we will walk through the following steps:</p>
<ul>
<li>Scaling and normalizing the data.</li>
<li>Applying spatial multimodal topic modeling to identify distinct cell
populations and explore their functional roles.</li>
<li>Visualizing the results to gain insight into the spatial
distribution of topics and cell types within the tissue.</li>
</ul>
<p>Let us begin by importing the required libraries and downloading the
filtered training data, available at <a href="https://zenodo.org/records/15472980" class="external-link">Zenodo</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TabakaLab/mTopicR" class="external-link">mTopic</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataset_name</span> <span class="op">&lt;-</span> <span class="st">"P22_Mouse_Brain_ATAC_RNA_filtered.rds"</span></span>
<span><span class="va">working_dir</span> <span class="op">&lt;-</span> <span class="st">'~/projects/datasets/'</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">working_dir</span>, <span class="va">dataset_name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span></span>
<span>    url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://zenodo.org/records/15472980/files/"</span>, <span class="va">dataset_name</span>, <span class="st">"?download=1"</span><span class="op">)</span>, </span>
<span>    destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">working_dir</span>, <span class="va">dataset_name</span><span class="op">)</span>, </span>
<span>    mode <span class="op">=</span> <span class="st">"wb"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="spatial-multimodal-topic-modeling">Spatial Multimodal Topic Modeling<a class="anchor" aria-label="anchor" href="#spatial-multimodal-topic-modeling"></a>
</h2>
<p>Load the prefiltered <code>Seurat</code> object with the human
tonsils dataset. The dataset comprises 9,215 spatial spots and two
modalities, <code>rna</code> (gene expression) and <code>atac</code>
(chromatin accessibility).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p22</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">working_dir</span>, <span class="va">dataset_name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Before we train the spatial Multimodal Topic Model
(<code>sMTM</code>), it is essential to preprocess the data to improve
the model’s ability to identify meaningful patterns across
modalities.</p>
<p>To ensure comparability between ATAC and RNA data, we apply the
following normalization and scaling steps:</p>
<ul>
<li>
<strong>TF-IDF transformation for RNA (<code>tfidf</code>).</strong>
Adjusts raw gene expression counts by balancing feature frequency and
importance, emphasizing rare but informative genes.</li>
<li>
<strong>Scaling across modalities
(<code>scale_counts</code>).</strong> Linearly scales counts to ensure
all modalities contribute equally during topic modeling, preventing one
from dominating the analysis.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tfidf.html">tfidf</a></span><span class="op">(</span><span class="va">p22</span>, mod <span class="op">=</span> <span class="st">'rna'</span><span class="op">)</span></span>
<span><span class="va">p22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tfidf.html">tfidf</a></span><span class="op">(</span><span class="va">p22</span>, mod <span class="op">=</span> <span class="st">'atac'</span><span class="op">)</span></span>
<span><span class="va">p22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_counts.html">scale_counts</a></span><span class="op">(</span><span class="va">p22</span><span class="op">)</span></span></code></pre></div>
<p>Now that the data is preprocessed, we can train the spatial
Multimodal Topic Model (<code>sMTM</code>). This model identifies
coordinated patterns across modalities while incorporating spatial
information. It captures co-expression of genes and proteins, revealing
distinct cell populations and their functional states.</p>
<ul>
<li><p><strong>Initialize the model</strong>. Create an instance of the
<code>sMTM</code> class, specifying the number of topics
(<code>n_topics</code>) and other parameters. We use 50 topics for this
tutorial for a compact but expressive model.</p></li>
<li><p><strong>Train the model</strong>. Fit the model using Variational
Inference (<code>VI</code>). This iterative process updates the model
parameters to explain the observed data best. While we use 500
iterations in this tutorial for thorough training, the model often
converges to meaningful topics in as few as 20 iterations. You can
adjust the number of iterations based on dataset size and desired
precision.</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smtm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sMTM.html">sMTM</a></span><span class="op">(</span><span class="va">p22</span>, n_topics <span class="op">=</span> <span class="fl">50</span>, radius <span class="op">=</span> <span class="fl">0.02</span>, n_jobs <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">smtm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VI.html">VI</a></span><span class="op">(</span><span class="va">smtm_model</span>, n_iter <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p>After training, export the learned parameters to the Seurat object
the using <code>export_params</code> function:</p>
<ul>
<li><p><strong>Topic proportions</strong> (<code>gamma</code> saved to
<code>object@reductions$mTopic</code>). Represent the distribution of
topics within each cell or spot. These proportions help identify which
topics are active in different tissue regions.</p></li>
<li><p><strong>Topic-feature distributions</strong> (<code>lambda</code>
saved to <code>object[[modality]]@meta.data</code>). Indicate the
importance of each feature for each topic. These distributions help
interpret the biological meaning of the topics.</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_params.html">export_params</a></span><span class="op">(</span><span class="va">smtm_model</span>, <span class="va">p22</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No assay specified, setting assay as RNA by default.</span></span>
<span><span class="va">p22</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 60000 features across 9215 samples within 2 assays </span></span>
<span><span class="co">#&gt; Active assay: atac (50000 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  3 layers present: counts, data, scale.data</span></span>
<span><span class="co">#&gt;  1 other assay present: rna</span></span>
<span><span class="co">#&gt;  2 dimensional reductions calculated: Spatial, mTopic</span></span></code></pre></div>
<p>The <code>export_params</code>. function not only exports model
parameters but can also filter out insignificant topics based on their
overall contribution. Topic filtering: Set
<code>filter_topics = TRUE</code> to automatically remove topics with
low overall activity. The <code>filter_threshold</code> parameter
controls the minimum average topic proportion required to retain a
topic.</p>
<p>This helps remove spurious or noise-driven topics, simplifying
downstream interpretation and visualization.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_filter_topics.html">plot_filter_topics</a></span><span class="op">(</span><span class="va">smtm_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial2_plot1.png" width="100%"></p>
<p>By preprocessing the data, training the <code>sMTM</code> model, and
exporting the learned parameters, we have set the stage for a
comprehensive analysis of cellular heterogeneity.</p>
</div>
<div class="section level2">
<h2 id="visualizing-topic-spot-distributions">Visualizing Topic-Spot Distributions<a class="anchor" aria-label="anchor" href="#visualizing-topic-spot-distributions"></a>
</h2>
<p>Visualizing topic distribution across cells or spatial spots is key
in interpreting topic modeling results. These proportions reflect the
contribution of each topic to each cell. They can reveal spatially
organized cell states, types, or biological processes.</p>
<p>To visualize topic proportions, use the <code>plot_topics</code>
function to generate scatter plots where each cell or spot is colored
according to the value of a selected topic. This reveals spatial
patterns and gradients that help interpret biological variation within
the tissue.</p>
<p>For example, if a topic captures a specific cell type, the plot will
highlight regions enriched in that population.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_topics.html">plot_topics</a></span><span class="op">(</span><span class="va">p22</span>, x <span class="op">=</span> <span class="st">'Spatial'</span>, s <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial2_plot2.png" width="100%"></p>
<p>To visualize overall trends in topic-spot distributions, use the
<code>plot_dominant_topics</code> function. This function assigns each
cell or spot to its most dominant topic — the one with the highest
proportion — and colors it accordingly.</p>
<p>The resulting plot provides a global overview of topic dominance
across the tissue, helping you quickly identify regions enriched in
specific topics. These regions may correspond to distinct cell types,
tissue structures, or gradients of biological activity.</p>
<p>This visualization is handy for detecting the tissue’s spatial
domains and functional zones.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">'topic_1'</span>  <span class="op">=</span> <span class="st">'#ffbcdd'</span>, <span class="st">'topic_2'</span>  <span class="op">=</span> <span class="st">'#aeffd6'</span>, <span class="st">'topic_3'</span>  <span class="op">=</span> <span class="st">'#f8e494'</span>,</span>
<span>  <span class="st">'topic_4'</span>  <span class="op">=</span> <span class="st">'#ffeef6'</span>, <span class="st">'topic_5'</span>  <span class="op">=</span> <span class="st">'#acc5de'</span>, <span class="st">'topic_6'</span>  <span class="op">=</span> <span class="st">'#f7de79'</span>,</span>
<span>  <span class="st">'topic_7'</span>  <span class="op">=</span> <span class="st">'#a1ffcf'</span>, <span class="st">'topic_8'</span>  <span class="op">=</span> <span class="st">'#93ffc9'</span>, <span class="st">'topic_9'</span>  <span class="op">=</span> <span class="st">'#86ffc2'</span>,</span>
<span>  <span class="st">'topic_10'</span> <span class="op">=</span> <span class="st">'#00cd00'</span>, <span class="st">'topic_11'</span> <span class="op">=</span> <span class="st">'#78ffbb'</span>, <span class="st">'topic_12'</span> <span class="op">=</span> <span class="st">'#20b2aa'</span>,</span>
<span>  <span class="st">'topic_13'</span> <span class="op">=</span> <span class="st">'#f5d75f'</span>, <span class="st">'topic_14'</span> <span class="op">=</span> <span class="st">'#83a8cd'</span>, <span class="st">'topic_15'</span> <span class="op">=</span> <span class="st">'#642915'</span>,</span>
<span>  <span class="st">'topic_16'</span> <span class="op">=</span> <span class="st">'#6bffb4'</span>, <span class="st">'topic_17'</span> <span class="op">=</span> <span class="st">'#5dffae'</span>, <span class="st">'topic_18'</span> <span class="op">=</span> <span class="st">'#ffff00'</span>,</span>
<span>  <span class="st">'topic_19'</span> <span class="op">=</span> <span class="st">'#000000'</span>, <span class="st">'topic_20'</span> <span class="op">=</span> <span class="st">'#5a8bbd'</span>, <span class="st">'topic_21'</span> <span class="op">=</span> <span class="st">'#bebebe'</span>,</span>
<span>  <span class="st">'topic_22'</span> <span class="op">=</span> <span class="st">'#50ffa7'</span>, <span class="st">'topic_23'</span> <span class="op">=</span> <span class="st">'#ffabd5'</span>, <span class="st">'topic_24'</span> <span class="op">=</span> <span class="st">'#f4d144'</span>,</span>
<span>  <span class="st">'topic_25'</span> <span class="op">=</span> <span class="st">'#f4a460'</span>, <span class="st">'topic_26'</span> <span class="op">=</span> <span class="st">'#ff0000'</span>, <span class="st">'topic_27'</span> <span class="op">=</span> <span class="st">'#43ffa0'</span>,</span>
<span>  <span class="st">'topic_28'</span> <span class="op">=</span> <span class="st">'#35ff99'</span>, <span class="st">'topic_29'</span> <span class="op">=</span> <span class="st">'#28ff93'</span>, <span class="st">'topic_30'</span> <span class="op">=</span> <span class="st">'#316eac'</span>,</span>
<span>  <span class="st">'topic_31'</span> <span class="op">=</span> <span class="st">'#003f5c'</span>, <span class="st">'topic_32'</span> <span class="op">=</span> <span class="st">'#08519c'</span>, <span class="st">'topic_33'</span> <span class="op">=</span> <span class="st">'#fff8dc'</span>,</span>
<span>  <span class="st">'topic_34'</span> <span class="op">=</span> <span class="st">'#cd853f'</span>, <span class="st">'topic_35'</span> <span class="op">=</span> <span class="st">'#ff9bcd'</span>, <span class="st">'topic_36'</span> <span class="op">=</span> <span class="st">'#ffffbf'</span>,</span>
<span>  <span class="st">'topic_37'</span> <span class="op">=</span> <span class="st">'#c9f4c9'</span>, <span class="st">'topic_38'</span> <span class="op">=</span> <span class="st">'#1aff8c'</span>, <span class="st">'topic_39'</span> <span class="op">=</span> <span class="st">'#f2ca29'</span>,</span>
<span>  <span class="st">'topic_40'</span> <span class="op">=</span> <span class="st">'#0dff85'</span>, <span class="st">'topic_41'</span> <span class="op">=</span> <span class="st">'#ee3a8c'</span>, <span class="st">'topic_42'</span> <span class="op">=</span> <span class="st">'#ff8ac4'</span>,</span>
<span>  <span class="st">'topic_43'</span> <span class="op">=</span> <span class="st">'#bcb8f4'</span>, <span class="st">'topic_44'</span> <span class="op">=</span> <span class="st">'#f1c40f'</span>, <span class="st">'topic_45'</span> <span class="op">=</span> <span class="st">'#006400'</span>,</span>
<span>  <span class="st">'topic_46'</span> <span class="op">=</span> <span class="st">'#ff79bc'</span>, <span class="st">'topic_47'</span> <span class="op">=</span> <span class="st">'#0000cd'</span>, <span class="st">'topic_48'</span> <span class="op">=</span> <span class="st">'#00ff7f'</span>, </span>
<span>  <span class="st">'topic_49'</span> <span class="op">=</span> <span class="st">'#8a508f'</span>, <span class="st">'topic_50'</span> <span class="op">=</span> <span class="st">'#ff69b4'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_dominant_topics.html">plot_dominant_topics</a></span><span class="op">(</span><span class="va">p22</span>, x <span class="op">=</span> <span class="st">'Spatial'</span>, s <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="va">palette</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial2_plot3.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="visualizing-feature-signatures">Visualizing Feature Signatures<a class="anchor" aria-label="anchor" href="#visualizing-feature-signatures"></a>
</h2>
<p>To interpret the results of the <code>sMTM</code> model, it is
important to examine the feature signatures associated with each topic.
Identifying the most relevant features for each topic provides insight
into the biological identity and function of the inferred cell
populations or processes.</p>
<p>Use the <code>plot_signatures</code> function to visualize the top
features per topic. This function generates a set of plots, each showing
the most significant features ranked by their importance for a given
topic.</p>
<p>These visualizations help reveal which molecular markers distinguish
topics, aiding in biological interpretation and annotation of the
results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_signatures.html">plot_signatures</a></span><span class="op">(</span><span class="va">p22</span>, mod <span class="op">=</span> <span class="st">'rna'</span>, n_top <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial2_plot4.png" width="100%"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_signatures.html">plot_signatures</a></span><span class="op">(</span><span class="va">p22</span>, mod <span class="op">=</span> <span class="st">'atac'</span>, n_top <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial2_plot5.png" width="100%"></p>
<p>To better understand the spatial relevance of topic signatures and
validate their biological specificity, you can visualize feature
z-scores. A z-score indicates how much a feature’s expression in a given
cell deviates from the mean, normalized by standard deviation. This
highlights significantly up- or downregulated features in specific
regions or cell populations.</p>
<p>Use <code>zscores</code> to compute modality-specific z-scores, and
<code>plot_corr_heatmap</code> to visualize their correlation with
topic-spot distributions.</p>
<p>In the example below, we compute z-scores for the top 100 peaks and
top 20 genes per topic to explore their spatial expression patterns.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zscores.html">zscores</a></span><span class="op">(</span><span class="va">p22</span>, mod <span class="op">=</span> <span class="st">'rna'</span>, n_top <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_corr_heatmap.html">plot_corr_heatmap</a></span><span class="op">(</span>data1<span class="op">=</span><span class="va">p22</span><span class="op">@</span><span class="va">reductions</span><span class="op">$</span><span class="va">mTopic</span><span class="op">@</span><span class="va">cell.embeddings</span>, label1 <span class="op">=</span> <span class="st">'sMTM topics'</span>, </span>
<span>                  data2<span class="op">=</span><span class="va">p22</span><span class="op">[[</span><span class="st">'rna'</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">zscores</span>, label2 <span class="op">=</span> <span class="st">'RNA z-scores'</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial2_plot6.png" width="100%"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zscores.html">zscores</a></span><span class="op">(</span><span class="va">p22</span>, mod <span class="op">=</span> <span class="st">'atac'</span>, n_top <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_corr_heatmap.html">plot_corr_heatmap</a></span><span class="op">(</span>data1<span class="op">=</span><span class="va">p22</span><span class="op">@</span><span class="va">reductions</span><span class="op">$</span><span class="va">mTopic</span><span class="op">@</span><span class="va">cell.embeddings</span>, label1 <span class="op">=</span> <span class="st">'sMTM topics'</span>, </span>
<span>                  data2<span class="op">=</span><span class="va">p22</span><span class="op">[[</span><span class="st">'atac'</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">zscores</span>, label2 <span class="op">=</span> <span class="st">'ATAC z-scores'</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial2_plot7.png" width="100%"></p>
<p>This concludes the example application of <code>mTopic</code> for
modeling spatial multimodal single-cell data, demonstrated using the P22
mouse brain dataset. We have walked through preprocessing, topic
modeling, and result interpretation, highlighting how
<code>mTopic</code> enables integrated analysis across modalities with
spatial context.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#saveRDS(p22, paste0(working_dir, 'P22_Mouse_Brain_ATAC_RNA_trained.rds'))</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Damian Panas, Piotr Rutkowski.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
